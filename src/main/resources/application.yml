spring:
  application:
    name: srishna-manual-posts
  cache:
    type: caffeine
    cache-names: postLists
    caffeine:
      spec: maximumSize=1000,expireAfterWrite=60s
  datasource:
    # DB is loaded from GCS (gs://prod_srishna_web/data/srishna.db) on startup. Path is system temp unless SQLITE_PATH is set.
    url: jdbc:sqlite:${SQLITE_PATH}
    driver-class-name: org.sqlite.JDBC
  jpa:
    hibernate:
      ddl-auto: update
    database-platform: org.hibernate.community.dialect.SQLiteDialect
    show-sql: false
  servlet:
    multipart:
      max-file-size: 100MB
      max-request-size: 100MB

# GCP: credentials from resources/dev_serviceAccountKey.json (or override with GCP_CREDENTIALS_PATH)
gcp:
  project-id: ${GCP_PROJECT_ID:global-repeater-479306-s2}
  bucket-name: ${GCP_BUCKET:prod_srishna_web}
  credentials-path: ${GCP_CREDENTIALS_PATH:classpath:dev_serviceAccountKey.json}
  # DB in bucket: gs://prod_srishna_web/data/srishna.db
  db-object-name: ${GCP_DB_OBJECT:data/srishna.db}
  # When true, return direct public GCS URLs (https://storage.googleapis.com/bucket/path) for images so they load fast and are cacheable. Bucket or objects must be public.
  public-urls: ${GCP_PUBLIC_URLS:false}
  # Image URL cache warming: pre-generate signed URLs in background so list APIs return fast. No behaviour change.
  url-cache-warm:
    enabled: ${GCP_URL_CACHE_WARM_ENABLED:true}
    delay-seconds: ${GCP_URL_CACHE_WARM_DELAY:5}
    batch-size: ${GCP_URL_CACHE_WARM_BATCH_SIZE:100}
    trigger-ratio: ${GCP_URL_CACHE_WARM_TRIGGER_RATIO:0.8}
    max-batches: ${GCP_URL_CACHE_WARM_MAX_BATCHES:2}

# JWT (use a long random secret in production)
jwt:
  secret: ${JWT_SECRET:srishna-dev-secret-change-in-production-min-256-bits}
  expiration-ms: ${JWT_EXPIRATION_MS:86400000}

# Base URL for share links, reset links, and HTML view og:url (no trailing slash).
# Production (Cloud Run): set APP_BASE_URL=https://srishna-image-upload-712085419978.asia-south1.run.app
# Backend URL for static assets (e.g. logo). Use when view is opened via frontend proxy (e.g. 5173);
# set APP_BACKEND_URL=http://localhost:8080 so logo loads from backend. In prod, set same as APP_BASE_URL.
app:
  base-url: ${APP_BASE_URL:http://localhost:5173}
  backend-url: ${APP_BACKEND_URL:http://localhost:8080}
  cors-origins: ${CORS_ORIGINS:http://localhost:5173,http://localhost:5174,http://localhost:8080,http://127.0.0.1:5173,http://127.0.0.1:5174,http://127.0.0.1:8080,https://srishna-manual-posts-ui-712085419978.asia-south1.run.app}
  # Runtime path for SQLite DB (same as datasource). Loaded from GCS on startup. Defaults to system temp via main().
  db-path: ${SQLITE_PATH}
server:
  port: ${PORT:8080}
  # Spring Boot 3: request header size (avoids "Request header is too large"). Send caption as form field "text", not in URL.
  max-http-request-header-size: 524288
  # Cloud Run terminates TLS and forwards protocol via headers.
  forward-headers-strategy: framework

# Swagger / OpenAPI
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html
    operationsSorter: method
    tagsSorter: alpha